<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Your Order - Banaras Bartan</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Custom CSS -->
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
        <img src="https://i.postimg.cc/bJMg6rx4/Whats-App-Image-2025-07-11-at-3-19-00-PM.jpg" 
             alt="Logo" class="navbar-logo me-2 rounded-circle">
        <div>
          <span class="brand-name">Banaras Bartan</span>
          <small class="brand-tagline d-block text-warning">Track Order</small>
        </div>
      </a>
      <div class="navbar-nav ms-auto">
        <a class="nav-link" href="{{ url_for('index') }}">
          <i class="fas fa-home me-1"></i>Back to Store
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow">
          <div class="card-header bg-primary text-white text-center">
            <h3><i class="fas fa-search me-2"></i>Track Your Order</h3>
          </div>
          <div class="card-body p-4">
            
            <!-- Search Form -->
            <form id="trackOrderForm" class="mb-4">
              <div class="row">
                <div class="col-md-8">
                  <div class="form-group">
                    <label for="customerPhone" class="form-label">Enter Your Phone Number</label>
                    <input type="tel" class="form-control" id="customerPhone" 
                           placeholder="Enter phone number used for order" required>
                  </div>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-2"></i>Track Order
                  </button>
                </div>
              </div>
            </form>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="text-center d-none">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2">Searching for your orders...</p>
            </div>

            <!-- Results Section -->
            <div id="orderResults" class="d-none">
              <h5 class="mb-3">Your Orders</h5>
              <div id="ordersList"></div>
            </div>

            <!-- No Orders Message -->
            <div id="noOrdersMessage" class="text-center d-none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>No orders found</strong><br>
                We couldn't find any orders with this phone number. Please check your number or contact us on WhatsApp.
              </div>
              <a href="https://wa.me/917571059297?text=Hello%2C%20I%20need%20help%20tracking%20my%20order" 
                 class="btn btn-success" target="_blank">
                <i class="fab fa-whatsapp me-2"></i>Contact Us on WhatsApp
              </a>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    document.getElementById('trackOrderForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const phone = document.getElementById('customerPhone').value.trim();
      if (!phone) return;
      
      // Show loading
      document.getElementById('loadingIndicator').classList.remove('d-none');
      document.getElementById('orderResults').classList.add('d-none');
      document.getElementById('noOrdersMessage').classList.add('d-none');
      
      try {
        const response = await fetch('/track-order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ phone: phone })
        });
        
        const data = await response.json();
        
        // Hide loading
        document.getElementById('loadingIndicator').classList.add('d-none');
        
        if (data.success && data.orders.length > 0) {
          displayOrders(data.orders);
        } else {
          document.getElementById('noOrdersMessage').classList.remove('d-none');
        }
        
      } catch (error) {
        console.error('Error tracking order:', error);
        document.getElementById('loadingIndicator').classList.add('d-none');
        document.getElementById('noOrdersMessage').classList.remove('d-none');
      }
    });
    
    function displayOrders(orders) {
      const ordersList = document.getElementById('ordersList');
      ordersList.innerHTML = '';
      
      orders.forEach(order => {
        const orderCard = document.createElement('div');
        orderCard.className = 'card mb-3';
        
        const statusColor = getStatusColor(order.order_status);
        const paymentStatusColor = getPaymentStatusColor(order.payment_status);
        
        orderCard.innerHTML = `
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <h6 class="card-title">Order #${order.id}</h6>
                <p class="card-text">
                  <strong>Product:</strong> ${order.product_name}<br>
                  <strong>Quantity:</strong> ${order.quantity}<br>
                  <strong>Total Amount:</strong> â‚¹${order.total_amount}<br>
                  <strong>Order Date:</strong> ${new Date(order.created_at).toLocaleDateString()}
                </p>
              </div>
              <div class="col-md-4 text-end">
                <div class="mb-2">
                  <span class="badge bg-${statusColor}">${order.order_status.toUpperCase()}</span>
                </div>
                <div class="mb-2">
                  <span class="badge bg-${paymentStatusColor}">${order.payment_status.toUpperCase()}</span>
                </div>
                <small class="text-muted">Payment: ${order.payment_method}</small>
              </div>
            </div>
            ${order.notes ? `<div class="mt-2"><small class="text-muted"><strong>Notes:</strong> ${order.notes}</small></div>` : ''}
          </div>
        `;
        
        ordersList.appendChild(orderCard);
      });
      
      document.getElementById('orderResults').classList.remove('d-none');
    }
    
    function getStatusColor(status) {
      switch(status) {
        case 'pending': return 'warning';
        case 'confirmed': return 'info';
        case 'shipped': return 'primary';
        case 'delivered': return 'success';
        case 'cancelled': return 'danger';
        default: return 'secondary';
      }
    }
    
    function getPaymentStatusColor(status) {
      switch(status) {
        case 'pending': return 'warning';
        case 'completed': return 'success';
        case 'failed': return 'danger';
        default: return 'secondary';
      }
    }
  </script>

</body>
</html>
